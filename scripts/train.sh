DATA_DIR="/mnt/petrelfs/linchen/FoundationalModel/data/multihead_datasets"
mace_run_train \
    --name="Test_Multihead" \
    --train_file="${DATA_DIR}/train" \
    --valid_file="${DATA_DIR}/val" \
    --test_dir="${DATA_DIR}/test" \
    --E0s="{'spice': {35: -70045.28385080204, 6: -1030.5671648271828, 17: -12522.649269035726, 9: -2715.318528602957, 1: -13.571964772646918, 53: -8102.524593409054, 7: -1486.3750255780376, 8: -2043.933693071156, 15: -9287.407133426237, 16: -10834.4844708122}, 'MatProj': {1: -1.11734008, 2: 0.00096759, 3: -0.29754725, 4: -0.01781697, 5: -0.26885011, 6: -1.26173507, 7: -3.12438806, 8: -1.54838784, 9: -0.51882044, 10: -0.01241601, 11: -0.22883163, 12: -0.00951015, 13: -0.21630193, 14: -0.8263903, 15: -1.88816619, 16: -0.89160769, 17: -0.25828273, 18: -0.04925973, 19: -0.22697913, 20: -0.0927795, 21: -2.11396364, 22: -2.50054871, 23: -3.70477179, 24: -5.60261985, 25: -5.32541181, 26: -3.52004933, 27: -1.93555024, 28: -0.9351969, 29: -0.60025846, 30: -0.1651332, 31: -0.32990651, 32: -0.77971828, 33: -1.68367812, 34: -0.76941032, 35: -0.22213843, 36: -0.0335879, 37: -0.1881724, 38: -0.06826294, 39: -2.17084228, 40: -2.28579303, 41: -3.13429753, 42: -4.60211419, 43: -3.45201492, 44: -2.38073513, 45: -1.46855515, 46: -1.4773126, 47: -0.33954585, 48: -0.16843877, 49: -0.35470981, 50: -0.83642657, 51: -1.41101987, 52: -0.65740879, 53: -0.18964571, 54: -0.00857582, 55: -0.13771876, 56: -0.03457659, 57: -0.45580806, 58: -1.3309175, 59: -0.29671824, 60: -0.30391193, 61: -0.30898427, 62: -0.25470891, 63: -8.38001538, 64: -10.38896525, 65: -0.3059505, 66: -0.30676216, 67: -0.30874667, 68: -0.28, 69: -0.25190039, 70: -0.06431414, 71: -0.31997586, 72: -3.52770927, 73: -3.54492209, 74: -4.0, 75: -4.70108713, 76: -2.88257209, 77: -1.46779304, 78: -0.50269936, 79: -0.28801193, 80: -0.12454674, 81: -0.31737194, 82: -0.77644932, 83: -1.32627283, 89: -0.26827152, 90: -0.90817426, 91: -2.47653193, 92: -4.90438537, 93: -7.63378961, 94: -10.77237713}}" \
    --model="MACE" \
    --num_interactions=2 \
    --num_channels=224 \
    --max_L=0 \
    --correlation=3 \
    --r_max=5.0 \
    --forces_weight=1000 \
    --energy_weight=40 \
    --weight_decay=5e-10 \
    --clip_grad=1.0 \
    --batch_size=32 \
    --valid_batch_size=128 \
    --max_num_epochs=210 \
    --patience=50 \
    --eval_interval=1 \
    --ema \
    --num_workers=8 \
    --error_table='PerAtomMAE' \
    --default_dtype="float64"\
    --device=cuda \
    --seed=123 \
    --save_cpu \
    --restart_latest \
    --loss="weighted" \
    --scheduler_patience=20 \
    --lr=0.01 \
    --swa \
    --swa_lr=0.00025 \
    --swa_forces_weight=100 \
    --start_swa=190 \
    --multi_processed_test=True \
    --heads="['spice', 'MatProj']" \
    --distributed \


    # fix dataset
    #--E0s="{'spice': {35: -70045.28385080204, 6: -1030.5671648271828, 17: -12522.649269035726, 9: -2715.318528602957, 1: -13.571964772646918, 53: -8102.524593409054, 7: -1486.3750255780376, 8: -2043.933693071156, 15: -9287.407133426237, 16: -10834.4844708122}, 'pbe': {1: -1.11734008, 2: 0.00096759, 3: -0.29754725, 4: -0.01781697, 5: -0.26885011, 6: -1.26173507, 7: -3.12438806, 8: -1.54838784, 9: -0.51882044, 10: -0.01241601, 11: -0.22883163, 12: -0.00951015, 13: -0.21630193, 14: -0.8263903, 15: -1.88816619, 16: -0.89160769, 17: -0.25828273, 18: -0.04925973, 19: -0.22697913, 20: -0.0927795, 21: -2.11396364, 22: -2.50054871, 23: -3.70477179, 24: -5.60261985, 25: -5.32541181, 26: -3.52004933, 27: -1.93555024, 28: -0.9351969, 29: -0.60025846, 30: -0.1651332, 31: -0.32990651, 32: -0.77971828, 33: -1.68367812, 34: -0.76941032, 35: -0.22213843, 36: -0.0335879, 37: -0.1881724, 38: -0.06826294, 39: -2.17084228, 40: -2.28579303, 41: -3.13429753, 42: -4.60211419, 43: -3.45201492, 44: -2.38073513, 45: -1.46855515, 46: -1.4773126, 47: -0.33954585, 48: -0.16843877, 49: -0.35470981, 50: -0.83642657, 51: -1.41101987, 52: -0.65740879, 53: -0.18964571, 54: -0.00857582, 55: -0.13771876, 56: -0.03457659, 57: -0.45580806, 58: -1.3309175, 59: -0.29671824, 60: -0.30391193, 61: -0.30898427, 62: -0.25470891, 63: -8.38001538, 64: -10.38896525, 65: -0.3059505, 66: -0.30676216, 67: -0.30874667, 69: -0.25190039, 70: -0.06431414, 71: -0.31997586, 72: -3.52770927, 73: -3.54492209, 75: -4.70108713, 76: -2.88257209, 77: -1.46779304, 78: -0.50269936, 79: -0.28801193, 80: -0.12454674, 81: -0.31737194, 82: -0.77644932, 83: -1.32627283, 89: -0.26827152, 90: -0.90817426, 91: -2.47653193, 92: -4.90438537, 93: -7.63378961, 94: -10.77237713}, 'r2scan': {1: -1.12257707, 2: -0.32637234, 3: -0.77457542, 4: -0.55373081, 5: -0.76968842, 6: -1.94307971, 7: -4.42961463, 8: -2.47302385, 9: -1.51072553, 10: -1.87539599, 11: -2.47748709, 12: -2.45880533, 13: -2.94374013, 14: -3.94316879, 15: -5.58336859, 16: -4.70851469, 17: -4.4369651, 18: -4.81466697, 19: -5.16188939, 20: -4.96292055, 21: -7.0595261, 22: -7.69177552, 23: -9.17472477, 24: -11.58666151, 25: -11.62004021, 26: -9.46584561, 27: -8.44670457, 28: -6.73976104, 29: -6.95631604, 30: -7.44059978, 31: -8.42502209, 32: -9.89520048, 33: -11.83477348, 34: -11.46975299, 35: -11.72868874, 36: -12.5286784, 37: -13.16934194, 38: -13.307911, 39: -15.85141443, 40: -16.61261047, 41: -18.18310326, 42: -20.4367982, 43: -19.40455077, 44: -19.12435324, 45: -18.09241223, 46: -18.7791836, 47: -18.47901653, 48: -19.04274997, 49: -20.02552029, 50: -21.42166158, 51: -23.14764278, 52: -22.88660021, 53: -23.13905012, 54: -23.82074791, 55: -24.40677946, 56: -24.40431834, 57: -25.79453496, 58: -26.59814791, 59: -25.33803052, 60: -25.24689196, 61: -25.21599217, 62: -25.21997038, 63: -36.37806435, 64: -39.00189148, 65: -26.718542, 66: -27.46120539, 67: -28.36097227, 69: -30.62404793, 70: -32.01029721, 71: -33.56669345, 72: -38.72115142, 73: -40.20707509, 75: -45.00968061, 76: -44.54910942, 77: -45.20204602, 78: -45.57704241, 79: -47.17567939, 80: -48.91084697, 81: -50.9203301, 82: -53.39473778, 83: -56.19960324, 89: -64.76998608, 90: -67.12576747, 91: -69.94618088, 92: -74.0422782, 93: -77.94982854, 94: -82.98131316}}" \
    #--heads="['spice', 'pbe', 'r2scan']" \


    #--eta_min=0.0001 \
    #--scheduler="CosineLR" \
    #--statistics_file="${DATA_DIR}/statistics.json" \

# TODO: larger weighted_distill 40
#    --swa \
#    --start_swa=115 \
#    --swa_lr=0.00025 \
#    --swa_forces_weight=10 \
